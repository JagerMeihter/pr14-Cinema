<Page x:Class="pr14_Cinema.Views.ProfilePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Личный кабинет">

    <Grid Background="#FFF5F5F5">
        <ScrollViewer>
            <StackPanel Margin="20">
                <!-- Кнопка назад -->
                <Button Content="← На главную" 
                        Click="BackButton_Click"
                        Background="Transparent" 
                        Foreground="#666666"
                        BorderThickness="0"
                        HorizontalAlignment="Left"
                        Margin="0,0,0,20"
                        Padding="0" Cursor="Hand"/>

                <!-- Основной контент -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="300"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Левая колонка - профиль -->
                    <Border Grid.Column="0" Background="White" Padding="20" 
                            CornerRadius="10" Margin="0,0,10,0">
                        <StackPanel>
                            <!-- Аватар и имя -->
                            <StackPanel HorizontalAlignment="Center" Margin="0,0,0,20">
                                <Border Width="100" Height="100" CornerRadius="50" 
                                        Background="#FFE0E0E0" BorderBrush="#CCCCCC" 
                                        BorderThickness="2" Margin="0,0,0,15">
                                    <TextBlock Text="👤" FontSize="40" 
                                               HorizontalAlignment="Center" 
                                               VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock x:Name="UserNameText" 
                                           FontSize="20" FontWeight="Bold"
                                           HorizontalAlignment="Center"/>
                                <TextBlock x:Name="UserEmailText" 
                                           Foreground="#666666"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>

                            <!-- Информация -->
                            <StackPanel Margin="0,20,0,0">
                                <TextBlock Text="📞 Телефон:" FontWeight="Bold" Margin="0,0,0,5"/>
                                <TextBlock x:Name="UserPhoneText" Margin="0,0,0,15"/>

                                <TextBlock Text="📅 Дата регистрации:" FontWeight="Bold" Margin="0,0,0,5"/>
                                <TextBlock x:Name="RegistrationDateText" Margin="0,0,0,15"/>

                                <TextBlock Text="🎫 Всего билетов:" FontWeight="Bold" Margin="0,0,0,5"/>
                                <TextBlock x:Name="TotalTicketsText" Margin="0,0,0,15"/>

                                <TextBlock Text="💰 Общая сумма:" FontWeight="Bold" Margin="0,0,0,5"/>
                                <TextBlock x:Name="TotalSpentText" Foreground="Green" FontWeight="Bold"/>
                            </StackPanel>

                            <!-- Кнопка выхода -->
                            <Button Content="Выйти из аккаунта" 
                                    Click="LogoutButton_Click"
                                    Background="#FFE0E0E0" Foreground="#333333"
                                    Margin="0,30,0,0" Padding="10,5"
                                    Cursor="Hand"/>
                        </StackPanel>
                    </Border>

                    <!-- Правая колонка - билеты -->
                    <Border Grid.Column="1" Background="White" Padding="20" CornerRadius="10">
                        <StackPanel>
                            <TextBlock Text="🎟️ Мои билеты" 
                                       FontSize="20" FontWeight="Bold"
                                       Margin="0,0,0,20"/>

                            <!-- Фильтры -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                <TextBlock Text="Статус:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <ComboBox x:Name="StatusFilterComboBox" Width="120" 
                                          SelectionChanged="StatusFilter_SelectionChanged">
                                    <ComboBoxItem Content="Все"/>
                                    <ComboBoxItem Content="Активные"/>
                                    <ComboBoxItem Content="Использованные"/>
                                    <ComboBoxItem Content="Отмененные"/>
                                </ComboBox>

                                <TextBlock Text="Сортировка:" VerticalAlignment="Center" Margin="30,0,10,0"/>
                                <ComboBox x:Name="SortTicketsComboBox" Width="150" 
                                          SelectionChanged="SortTickets_SelectionChanged">
                                    <ComboBoxItem Content="По дате (новые)"/>
                                    <ComboBoxItem Content="По дате (старые)"/>
                                    <ComboBoxItem Content="По цене (дорогие)"/>
                                    <ComboBoxItem Content="По цене (дешевые)"/>
                                </ComboBox>
                            </StackPanel>

                            <!-- Список билетов -->
                            <ItemsControl x:Name="TicketsList">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border BorderBrush="#E0E0E0" BorderThickness="1" 
                                                Margin="0,0,0,10" Padding="15" CornerRadius="5">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Информация о билете -->
                                                <StackPanel Grid.Column="0">
                                                    <TextBlock FontSize="16" FontWeight="Bold">
                                                        <Run Text="{Binding MovieTitle}"/>
                                                        <Run Text=" - "/>
                                                        <Run Text="{Binding SessionDateTime, StringFormat={}{0:dd.MM.yyyy HH:mm}}"/>
                                                    </TextBlock>

                                                    <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                                        <TextBlock>
                                                            <Run Text="Зал: "/>
                                                            <Run Text="{Binding HallName}"/>
                                                            <Run Text=" (Место: "/>
                                                            <Run Text="{Binding SeatInfo}"/>
                                                            <Run Text=")"/>
                                                        </TextBlock>
                                                    </StackPanel>

                                                    <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                                        <TextBlock>
                                                            <Run Text="Статус: "/>
                                                            <Run Text="{Binding Status}" FontWeight="Bold"/>
                                                        </TextBlock>

                                                        <TextBlock Margin="30,0,0,0">
                                                            <Run Text="Куплен: "/>
                                                            <Run Text="{Binding PurchaseDate, StringFormat={}{0:dd.MM.yyyy}}"/>
                                                        </TextBlock>
                                                    </StackPanel>
                                                </StackPanel>

                                                <!-- Цена и действия -->
                                                <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                                                    <TextBlock FontSize="18" FontWeight="Bold" Foreground="Green">
                                                        <Run Text="{Binding Price, StringFormat={}{0}₽}"/>
                                                    </TextBlock>

                                                    <Button Content="Отменить" 
                                                            Click="CancelTicket_Click"
                                                            Tag="{Binding Id}"
                                                            Background="#FFE0E0E0" 
                                                            Foreground="#333333"
                                                            Margin="0,10,0,0" Padding="10,5"
                                                            Cursor="Hand"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- Сообщение если нет билетов -->
                            <TextBlock x:Name="NoTicketsText" 
                                       Text="У вас еще нет билетов"
                                       Foreground="#666666" FontStyle="Italic"
                                       HorizontalAlignment="Center" Margin="20"
                                       Visibility="Collapsed"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>